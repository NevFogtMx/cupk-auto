import{_ as Y,r as p,a as d,o as g,c as F,b as l,w as r,i as n,d as B,F as Z,E as b,k as ee,g as f,j as y,p as le,h as ae,l as te}from"./index-40bce0d9.js";const m=C=>(le("data-v-8e9335e4"),C=C(),ae(),C),oe=m(()=>n("div",{class:"tip"},[f(" # 建议只使用"),n("em",null," 本学期计划选课 "),f("和"),n("em",null," 公选课选课 "),n("br"),f(" # "),n("em",null,"抢课过程中不要切换界面或进行其他操作")],-1)),se=m(()=>n("br",null,null,-1)),ne=m(()=>n("div",{class:"el-upload__text"},[f(" 拖拽上传 or "),n("em",null,"点击上传")],-1)),ue=m(()=>n("div",{class:"el-upload__tip"}," 仅支持xls文件，建议上传筛选后的文件，减少excel行数，不超过50行，否则会出现卡顿 ",-1)),ce=m(()=>n("br",null,null,-1)),re={class:"qkdiv"},ie=m(()=>n("span",{class:"tip"}," 失败循环抢课次数 ：",-1)),pe=m(()=>n("br",null,null,-1)),de=m(()=>n("br",null,null,-1)),ve=m(()=>n("br",null,null,-1)),_e={key:0,class:"demo-pagination-block"},fe={__name:"SisSelectCourse",setup(C){const k=p(1),x=p(8),E=p(1),I=p({}),w=p([]),S=p([]),V=p([]),j=p([]),z=p([]),c=p("可选课程"),a=p(w.value),N=p(0);function q(e){e=="可选课程"?a.value=w.value:e=="本学期计划选课"?a.value=S.value:e=="专业内跨年级选课"?a.value=V.value:e=="跨专业选课"?a.value=j.value:a.value=z.value}function O(e){if(I.value[e.courseId+e.classId]==1){b({message:"该课程已添加",type:"warning"});return}e.mode=="0"?S.value.push(e):e.mode=="1"?V.value.push(e):e.mode=="2"?j.value.push(e):e.mode=="3"&&z.value.push(e),I.value[e.courseId+e.classId]=1,N.value=a.value.length}function J(e,o){I.value[o.courseId+o.classId]=0,c.value=="本学期计划选课"?(S.value.splice(e,1),a.value=S.value):c.value=="专业内跨年级选课"?(V.value.splice(e,1),a.value=V.value):c.value=="跨专业选课"?(j.value.splice(e,1),a.value=j.value):(z.value.splice(e,1),a.value=z.value)}function M(e,o){e.code==1&&(w.value=e.data,a.value=w.value,N.value=a.value.length,e.data.forEach((v,i,t)=>{I.value[v.courseId+v.classId]=0}))}function Q(e){return new Promise(o=>setTimeout(o,e))}function R(e){return e=="本学期计划选课"?0:e=="专业内跨年级选课"?1:e=="跨专业选课"?2:3}async function A(){await fetch("http://localhost:8877/jwxt/xk/login").then(e=>e.json()).then(e=>{e.code!=1&&b({message:"进入选课系统失败",type:"error"})}).catch(e=>{console.log(e)})}async function P(e,o,v,i){await fetch("http://localhost:8877/jwxt/xk/selectCourse",{method:"POST",headers:{"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({params:{kcxx:v,skls:"",skxq:"",skjc:"",sfym:"false",sfct:"false",sfxx:"false"},courselist:e,mode:o})}).then(t=>t.json()).then(t=>{t.code==1&&(i>-1?t.data[0].success&&(a.value[i].ready=1):t.data.forEach((h,u,D)=>{h.success&&(a.value[u].ready=1)}))}).catch(t=>{console.log(t)})}async function G(){await A();let e=["本学期计划选课","公选课选课","专业内跨年级选课","跨专业选课"];for(let o=0;o<e.length;o++){if(c.value=e[o],q(c.value),a.value.length==0){b({message:"没有可抢课程",type:"warning"});continue}let v=R(c.value),i=[];a.value.forEach((t,h,u)=>{i.push(t.courseId+t.classId)});for(let t=0;t<E.value;t++){if(b({message:`第${t+1}次抢课开始`,type:"success"}),await Q(1e3),v==0||v==3)await P(i,v,"");else for(let u=0;u<i.length;u++)await P([i[u]],v,i[u].substring(0,i[u].length-2),u);let h=!0;for(let u=0;u<a.value.length;u++)if(a.value[u].ready==0){h=!1;break}if(h){b({message:"本表所有课程已抢完",type:"success"});break}}}c.value="可选课程",q(c.value),b({message:"抢课结束",type:"success"})}const H=e=>{};function K(e){k.value=e,a.value=w.value.slice((k.value-1)*x.value,k.value*x.value),console.log(a.value)}return(e,o)=>{const v=d("el-icon"),i=d("el-upload"),t=d("el-radio-button"),h=d("el-radio-group"),u=d("el-input-number"),D=d("el-button"),_=d("el-table-column"),U=d("el-option"),L=d("el-select"),$=d("el-tag"),W=d("el-table"),X=d("el-pagination");return g(),F(Z,null,[oe,se,l(i,{class:"upload-demo",drag:"",action:"http://localhost:8877/jwxt/xk/upload",multiple:"",accept:".xls","on-success":M},{tip:r(()=>[ue]),default:r(()=>[l(v,{class:"el-icon--upload"},{default:r(()=>[l(ee(te))]),_:1}),ne]),_:1}),n("div",null,[l(h,{modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=s=>c.value=s),size:"large",onChange:q},{default:r(()=>[l(t,{label:"可选课程"}),l(t,{label:"本学期计划选课"}),l(t,{label:"专业内跨年级选课"}),l(t,{label:"跨专业选课"}),l(t,{label:"公选课选课"})]),_:1},8,["modelValue"]),ce,n("div",re,[ie,l(u,{modelValue:E.value,"onUpdate:modelValue":o[1]||(o[1]=s=>E.value=s),min:1,max:10},null,8,["modelValue"]),l(D,{type:"primary",class:"qkbutton",onClick:G},{default:r(()=>[f("开始抢课")]),_:1})]),pe]),de,l(W,{ref:"tableRef",border:"",data:a.value,"max-height":"460px",style:{width:"100%"}},{default:r(()=>[l(_,{align:"center","show-overflow-tooltip":"",prop:"courseId",label:"课程代码"}),l(_,{align:"center","show-overflow-tooltip":"",prop:"classId",label:"教学班"}),l(_,{align:"center","show-overflow-tooltip":"",prop:"courseName",label:"课程名称"}),l(_,{align:"center","show-overflow-tooltip":"",prop:"teacher",label:"上课教师"}),l(_,{align:"center","show-overflow-tooltip":"",prop:"time",label:"上课时间"}),l(_,{align:"center","show-overflow-tooltip":"",prop:"class",label:"上课班级"}),l(_,{align:"center","show-overflow-tooltip":"",prop:"type",label:"课程属性"}),c.value=="可选课程"?(g(),y(_,{key:0,align:"center","show-overflow-tooltip":"",prop:"mode",label:"选课模式"},{default:r(s=>[l(L,{modelValue:s.row.mode,"onUpdate:modelValue":T=>s.row.mode=T,placeholder:"请选择"},{default:r(()=>[l(U,{label:"本学期计划选课",value:"0"}),l(U,{label:"专业内跨年级选课",value:"1"}),l(U,{label:"跨专业选课",value:"2"}),l(U,{label:"公选课选课",value:"3"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1})):B("",!0),c.value!="可选课程"?(g(),y(_,{key:1,align:"center","show-overflow-tooltip":"",prop:"type",label:"抢课状态"},{default:r(s=>[s.row.ready==1?(g(),y($,{key:0,type:"success"},{default:r(()=>[f("已抢")]),_:1})):(g(),y($,{key:1,type:"danger"},{default:r(()=>[f("未抢")]),_:1}))]),_:1})):B("",!0),l(_,{align:"center",label:"添加选课"},{default:r(s=>[c.value=="可选课程"?(g(),y(D,{key:0,text:"",type:"primary",size:"small",onClick:T=>O(s.row)},{default:r(()=>[f("添加")]),_:2},1032,["onClick"])):(g(),y(D,{key:1,text:"",type:"danger",size:"small",onClick:T=>J(s.$index,s.row)},{default:r(()=>[f("删除")]),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"]),ve,c.value=="可选课程"?(g(),F("div",_e,[l(X,{"current-page":k.value,"onUpdate:currentPage":o[2]||(o[2]=s=>k.value=s),"page-size":x.value,"onUpdate:pageSize":o[3]||(o[3]=s=>x.value=s),"pager-count":5,layout:"total, prev, pager, next, jumper",total:N.value,onSizeChange:H,onCurrentChange:K},null,8,["current-page","page-size","total"])])):B("",!0)],64)}}},ge=Y(fe,[["__scopeId","data-v-8e9335e4"]]);export{ge as default};
